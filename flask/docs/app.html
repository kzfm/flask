<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>app.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  
  <div class='section'>
    <div class='docs'><h1>app.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <pre><code>flask.app
~~~~~~~~~

This module implements the central WSGI application object.

:copyright: (c) 2011 by Armin Ronacher.
:license: BSD, see LICENSE for more details.
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">with_statement</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Lock</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">update_wrapper</span>

<span class="kn">from</span> <span class="nn">werkzeug.datastructures</span> <span class="kn">import</span> <span class="n">ImmutableDict</span>
<span class="kn">from</span> <span class="nn">werkzeug.routing</span> <span class="kn">import</span> <span class="n">Map</span><span class="p">,</span> <span class="n">Rule</span><span class="p">,</span> <span class="n">RequestRedirect</span><span class="p">,</span> <span class="n">BuildError</span>
<span class="kn">from</span> <span class="nn">werkzeug.exceptions</span> <span class="kn">import</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">InternalServerError</span><span class="p">,</span> \
     <span class="n">MethodNotAllowed</span><span class="p">,</span> <span class="n">BadRequest</span>

<span class="kn">from</span> <span class="nn">.helpers</span> <span class="kn">import</span> <span class="n">_PackageBoundObject</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">get_flashed_messages</span><span class="p">,</span> \
    <span class="n">locked_cached_property</span><span class="p">,</span> <span class="n">_endpoint_from_view_func</span><span class="p">,</span> <span class="n">find_package</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="nn">.wrappers</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">.config</span> <span class="kn">import</span> <span class="n">ConfigAttribute</span><span class="p">,</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">.ctx</span> <span class="kn">import</span> <span class="n">RequestContext</span><span class="p">,</span> <span class="n">AppContext</span><span class="p">,</span> <span class="n">_AppCtxGlobals</span>
<span class="kn">from</span> <span class="nn">.globals</span> <span class="kn">import</span> <span class="n">_request_ctx_stack</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">g</span>
<span class="kn">from</span> <span class="nn">.sessions</span> <span class="kn">import</span> <span class="n">SecureCookieSessionInterface</span>
<span class="kn">from</span> <span class="nn">.module</span> <span class="kn">import</span> <span class="n">blueprint_is_module</span>
<span class="kn">from</span> <span class="nn">.templating</span> <span class="kn">import</span> <span class="n">DispatchingJinjaLoader</span><span class="p">,</span> <span class="n">Environment</span><span class="p">,</span> \
    <span class="n">_default_template_ctx_processor</span>
<span class="kn">from</span> <span class="nn">.signals</span> <span class="kn">import</span> <span class="n">request_started</span><span class="p">,</span> <span class="n">request_finished</span><span class="p">,</span> <span class="n">got_request_exception</span><span class="p">,</span> \
    <span class="n">request_tearing_down</span><span class="p">,</span> <span class="n">appcontext_tearing_down</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>a lock used for logger initialization</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">_logger_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_make_timedelta</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Wraps a method so that it performs a check in debug mode if the</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">setupmethod</span><span class="p">(</span><span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>first request was already handled.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">wrapper_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_got_first_request</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;A setup function was called after the &#39;</span>
                <span class="s">&#39;first request was handled.  This usually indicates a bug &#39;</span>
                <span class="s">&#39;in the application where a module was not imported &#39;</span>
                <span class="s">&#39;and decorators or other functionality was called too late.</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;To fix this make sure to import all your view modules, &#39;</span>
                <span class="s">&#39;database models and everything related at a central place &#39;</span>
                <span class="s">&#39;before the application starts serving requests.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper_func</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>The flask object implements a WSGI application and acts as the central</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">_PackageBoundObject</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>object.  It is passed the name of the module or package of the
application.  Once it is created it will act as a central registry for
the view functions, the URL rules, template configuration and much more.</p>
<p>The name of the package is used to resolve resources from inside the
package or the folder the module is contained in depending on if the
package parameter resolves to an actual python package (a folder with
an <code>__init__.py</code> file inside) or a standard module (just a <code>.py</code> file).</p>
<p>For more information about resource loading, see :func:<code>open_resource</code>.</p>
<p>Usually you create a :class:<code>Flask</code> instance in your main module or
in the <code>__init__.py</code> file of your package like this::</p>
<pre><code>from flask import Flask
app = Flask(__name__)
</code></pre>
<p>.. admonition:: About the First Parameter</p>
<pre><code>The idea of the first parameter is to give Flask an idea what
belongs to your application.  This name is used to find resources
on the file system, can be used by extensions to improve debugging
information and a lot more.

So it's important what you provide there.  If you are using a single
module, `__name__` is always the correct value.  If you however are
using a package, it's usually recommended to hardcode the name of
your package there.

For example if your application is defined in `yourapplication/app.py`
you should create it with one of the two versions below::

    app = Flask('yourapplication')
    app = Flask(__name__.split('.')[0])

Why is that?  The application will work even with `__name__`, thanks
to how resources are looked up.  However it will make debugging more
painful.  Certain extensions can make assumptions based on the
import name of your application.  For example the Flask-SQLAlchemy
extension will look for the code in your application that triggered
an SQL query in debug mode.  If the import name is not properly set
up, that debugging information is lost.  (For example it would only
pick up SQL queries in `yourapplication.app` and not
`yourapplication.views.frontend`)
</code></pre>
<p>.. versionadded:: 0.7
   The <code>static_url_path</code>, <code>static_folder</code>, and <code>template_folder</code>
   parameters were added.</p>
<p>.. versionadded:: 0.8
   The <code>instance_path</code> and <code>instance_relative_config</code> parameters were
   added.</p>
<p>:param import_name: the name of the application package
:param static_url_path: can be used to specify a different path for the
                        static files on the web.  Defaults to the name
                        of the <code>static_folder</code> folder.
:param static_folder: the folder with static files that should be served
                      at <code>static_url_path</code>.  Defaults to the <code>'static'</code>
                      folder in the root path of the application.
:param template_folder: the folder that contains the templates that should
                        be used by the application.  Defaults to
                        <code>'templates'</code> folder in the root path of the
                        application.
:param instance_path: An alternative instance path for the application.
                      By default the folder <code>'instance'</code> next to the
                      package or module is assumed to be the instance
                      path.
:param instance_relative_config: if set to <code>True</code> relative filenames
                                 for loading the config are assumed to
                                 be relative to the instance path instead
                                 of the application root.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>: The class that is used for request objects.  See :class:<code>~flask.Request</code>
: for more information.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">request_class</span> <span class="o">=</span> <span class="n">Request</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>: The class that is used for response objects.  See
: :class:<code>~flask.Response</code> for more information.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">response_class</span> <span class="o">=</span> <span class="n">Response</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>: The class that is used for the :data:<code>~flask.g</code> instance.
:
: Example use cases for a custom class:
:
: 1. Store arbitrary attributes on flask.g.
: 2. Add a property for lazy per-request database connectors.
: 3. Return None instead of AttributeError on expected attributes.
: 4. Raise exception if an unexpected attr is set, a "controlled" flask.g.
:
: In Flask 0.9 this property was called <code>request_globals_class</code> but it
: was changed in 0.10 to :attr:<code>app_ctx_globals_class</code> because the
: flask.g object is not application context scoped.
:
: .. versionadded:: 0.10</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">app_ctx_globals_class</span> <span class="o">=</span> <span class="n">_AppCtxGlobals</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Backwards compatibility support</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_get_request_globals_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_ctx_globals_class</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_set_request_globals_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
        <span class="n">warn</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s">&#39;request_globals_class attribute is now &#39;</span>
                                <span class="s">&#39;called app_ctx_globals_class&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_ctx_globals_class</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">request_globals_class</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_request_globals_class</span><span class="p">,</span>
                                     <span class="n">_set_request_globals_class</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">_get_request_globals_class</span><span class="p">,</span> <span class="n">_set_request_globals_class</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>: The debug flag.  Set this to <code>True</code> to enable debugging of the
: application.  In debug mode the debugger will kick in when an unhandled
: exception ocurrs and the integrated server will automatically reload
: the application if changes in the code are detected.
:
: This attribute can also be configured from the config with the <code>DEBUG</code>
: configuration key.  Defaults to <code>False</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">debug</span> <span class="o">=</span> <span class="n">ConfigAttribute</span><span class="p">(</span><span class="s">&#39;DEBUG&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>: The testing flag.  Set this to <code>True</code> to enable the test mode of
: Flask extensions (and in the future probably also Flask itself).
: For example this might activate unittest helpers that have an
: additional runtime cost which should not be enabled by default.
:
: If this is enabled and PROPAGATE_EXCEPTIONS is not changed from the
: default it's implicitly enabled.
:
: This attribute can also be configured from the config with the
: <code>TESTING</code> configuration key.  Defaults to <code>False</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">testing</span> <span class="o">=</span> <span class="n">ConfigAttribute</span><span class="p">(</span><span class="s">&#39;TESTING&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>: If a secret key is set, cryptographic components can use this to
: sign cookies and other things.  Set this to a complex random value
: when you want to use the secure cookie for instance.
:
: This attribute can also be configured from the config with the
: <code>SECRET_KEY</code> configuration key.  Defaults to <code>None</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">secret_key</span> <span class="o">=</span> <span class="n">ConfigAttribute</span><span class="p">(</span><span class="s">&#39;SECRET_KEY&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>: The secure cookie uses this for the name of the session cookie.
:
: This attribute can also be configured from the config with the
: <code>SESSION_COOKIE_NAME</code> configuration key.  Defaults to <code>'session'</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">session_cookie_name</span> <span class="o">=</span> <span class="n">ConfigAttribute</span><span class="p">(</span><span class="s">&#39;SESSION_COOKIE_NAME&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>: A :class:<code>~datetime.timedelta</code> which is used to set the expiration
: date of a permanent session.  The default is 31 days which makes a
: permanent session survive for roughly one month.
:
: This attribute can also be configured from the config with the
: <code>PERMANENT_SESSION_LIFETIME</code> configuration key.  Defaults to
: <code>timedelta(days=31)</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">permanent_session_lifetime</span> <span class="o">=</span> <span class="n">ConfigAttribute</span><span class="p">(</span><span class="s">&#39;PERMANENT_SESSION_LIFETIME&#39;</span><span class="p">,</span>
        <span class="n">get_converter</span><span class="o">=</span><span class="n">_make_timedelta</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>: Enable this if you want to use the X-Sendfile feature.  Keep in
: mind that the server has to support this.  This only affects files
: sent with the :func:<code>send_file</code> method.
:
: .. versionadded:: 0.2
:
: This attribute can also be configured from the config with the
: <code>USE_X_SENDFILE</code> configuration key.  Defaults to <code>False</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">use_x_sendfile</span> <span class="o">=</span> <span class="n">ConfigAttribute</span><span class="p">(</span><span class="s">&#39;USE_X_SENDFILE&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>: The name of the logger to use.  By default the logger name is the
: package name passed to the constructor.
:
: .. versionadded:: 0.4</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">logger_name</span> <span class="o">=</span> <span class="n">ConfigAttribute</span><span class="p">(</span><span class="s">&#39;LOGGER_NAME&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>: Enable the deprecated module support?  This is active by default
: in 0.7 but will be changed to False in 0.8.  With Flask 1.0 modules
: will be removed in favor of Blueprints</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">enable_modules</span> <span class="o">=</span> <span class="bp">True</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>: The logging format used for the debug logger.  This is only used when
: the application is in debug mode, otherwise the attached logging
: handler does the formatting.
:
: .. versionadded:: 0.3</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">debug_log_format</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span>
        <span class="s">&#39;</span><span class="si">%(levelname)s</span><span class="s"> in </span><span class="si">%(module)s</span><span class="s"> [</span><span class="si">%(pathname)s</span><span class="s">:</span><span class="si">%(lineno)d</span><span class="s">]:</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span>
        <span class="s">&#39;</span><span class="si">%(message)s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span>
        <span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span>
    <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>: The JSON encoder class to use.  Defaults to :class:<code>~flask.json.JSONEncoder</code>.
:
: .. versionadded:: 0.10</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">json_encoder</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>: The JSON decoder class to use.  Defaults to :class:<code>~flask.json.JSONDecoder</code>.
:
: .. versionadded:: 0.10</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">json_decoder</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecoder</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>: Options that are passed directly to the Jinja2 environment.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">jinja_options</span> <span class="o">=</span> <span class="n">ImmutableDict</span><span class="p">(</span>
        <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;jinja2.ext.autoescape&#39;</span><span class="p">,</span> <span class="s">&#39;jinja2.ext.with_&#39;</span><span class="p">]</span>
    <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>: Default configuration parameters.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">default_config</span> <span class="o">=</span> <span class="n">ImmutableDict</span><span class="p">({</span>
        <span class="s">&#39;DEBUG&#39;</span><span class="p">:</span>                                <span class="bp">False</span><span class="p">,</span>
        <span class="s">&#39;TESTING&#39;</span><span class="p">:</span>                              <span class="bp">False</span><span class="p">,</span>
        <span class="s">&#39;PROPAGATE_EXCEPTIONS&#39;</span><span class="p">:</span>                 <span class="bp">None</span><span class="p">,</span>
        <span class="s">&#39;PRESERVE_CONTEXT_ON_EXCEPTION&#39;</span><span class="p">:</span>        <span class="bp">None</span><span class="p">,</span>
        <span class="s">&#39;SECRET_KEY&#39;</span><span class="p">:</span>                           <span class="bp">None</span><span class="p">,</span>
        <span class="s">&#39;PERMANENT_SESSION_LIFETIME&#39;</span><span class="p">:</span>           <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">31</span><span class="p">),</span>
        <span class="s">&#39;USE_X_SENDFILE&#39;</span><span class="p">:</span>                       <span class="bp">False</span><span class="p">,</span>
        <span class="s">&#39;LOGGER_NAME&#39;</span><span class="p">:</span>                          <span class="bp">None</span><span class="p">,</span>
        <span class="s">&#39;SERVER_NAME&#39;</span><span class="p">:</span>                          <span class="bp">None</span><span class="p">,</span>
        <span class="s">&#39;APPLICATION_ROOT&#39;</span><span class="p">:</span>                     <span class="bp">None</span><span class="p">,</span>
        <span class="s">&#39;SESSION_COOKIE_NAME&#39;</span><span class="p">:</span>                  <span class="s">&#39;session&#39;</span><span class="p">,</span>
        <span class="s">&#39;SESSION_COOKIE_DOMAIN&#39;</span><span class="p">:</span>                <span class="bp">None</span><span class="p">,</span>
        <span class="s">&#39;SESSION_COOKIE_PATH&#39;</span><span class="p">:</span>                  <span class="bp">None</span><span class="p">,</span>
        <span class="s">&#39;SESSION_COOKIE_HTTPONLY&#39;</span><span class="p">:</span>              <span class="bp">True</span><span class="p">,</span>
        <span class="s">&#39;SESSION_COOKIE_SECURE&#39;</span><span class="p">:</span>                <span class="bp">False</span><span class="p">,</span>
        <span class="s">&#39;MAX_CONTENT_LENGTH&#39;</span><span class="p">:</span>                   <span class="bp">None</span><span class="p">,</span>
        <span class="s">&#39;SEND_FILE_MAX_AGE_DEFAULT&#39;</span><span class="p">:</span>            <span class="mi">12</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="c"># 12 hours</span>
        <span class="s">&#39;TRAP_BAD_REQUEST_ERRORS&#39;</span><span class="p">:</span>              <span class="bp">False</span><span class="p">,</span>
        <span class="s">&#39;TRAP_HTTP_EXCEPTIONS&#39;</span><span class="p">:</span>                 <span class="bp">False</span><span class="p">,</span>
        <span class="s">&#39;PREFERRED_URL_SCHEME&#39;</span><span class="p">:</span>                 <span class="s">&#39;http&#39;</span><span class="p">,</span>
        <span class="s">&#39;JSON_AS_ASCII&#39;</span><span class="p">:</span>                        <span class="bp">True</span>
    <span class="p">})</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>: The rule object to use for URL rules created.  This is used by
: :meth:<code>add_url_rule</code>.  Defaults to :class:<code>werkzeug.routing.Rule</code>.
:
: .. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">url_rule_class</span> <span class="o">=</span> <span class="n">Rule</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>: the test client that is used with when <code>test_client</code> is used.
:
: .. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">test_client_class</span> <span class="o">=</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>: the session interface to use.  By default an instance of
: :class:<code>~flask.sessions.SecureCookieSessionInterface</code> is used here.
:
: .. versionadded:: 0.8</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">session_interface</span> <span class="o">=</span> <span class="n">SecureCookieSessionInterface</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">import_name</span><span class="p">,</span> <span class="n">static_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">static_url_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">static_folder</span><span class="o">=</span><span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="s">&#39;templates&#39;</span><span class="p">,</span>
                 <span class="n">instance_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">instance_relative_config</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">_PackageBoundObject</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">import_name</span><span class="p">,</span>
                                     <span class="n">template_folder</span><span class="o">=</span><span class="n">template_folder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">static_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
            <span class="n">warn</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s">&#39;static_path is now called &#39;</span>
                                    <span class="s">&#39;static_url_path&#39;</span><span class="p">),</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">static_url_path</span> <span class="o">=</span> <span class="n">static_path</span>

        <span class="k">if</span> <span class="n">static_url_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">static_url_path</span> <span class="o">=</span> <span class="n">static_url_path</span>
        <span class="k">if</span> <span class="n">static_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">static_folder</span> <span class="o">=</span> <span class="n">static_folder</span>
        <span class="k">if</span> <span class="n">instance_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">instance_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_find_instance_path</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">instance_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;If an instance path is provided it must be &#39;</span>
                             <span class="s">&#39;absolute.  A relative path was given instead.&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>: Holds the path to the instance folder.
:
: .. versionadded:: 0.8</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">instance_path</span> <span class="o">=</span> <span class="n">instance_path</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>: The configuration dictionary as :class:<code>Config</code>.  This behaves
: exactly like a regular dictionary but supports additional methods
: to load a config from files.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_config</span><span class="p">(</span><span class="n">instance_relative_config</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>Prepare the deferred setup of the logger.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_name</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>: A dictionary of all view functions registered.  The keys will
: be function names which are also used to generate URLs and
: the values are the function objects themselves.
: To register a view function, use the :meth:<code>route</code> decorator.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">view_functions</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>support for the now deprecated <code>error_handlers</code> attribute.  The
:attr:<code>error_handler_spec</code> shall be used now.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_error_handlers</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>: A dictionary of all registered error handlers.  The key is <code>None</code>
: for error handlers active on the application, otherwise the key is
: the name of the blueprint.  Each key points to another dictionary
: where they key is the status code of the http exception.  The
: special key <code>None</code> points to a list of tuples where the first item
: is the class for the instance check and the second the error handler
: function.
:
: To register a error handler, use the :meth:<code>errorhandler</code>
: decorator.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler_spec</span> <span class="o">=</span> <span class="p">{</span><span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error_handlers</span><span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>: A list of functions that are called when :meth:<code>url_for</code> raises a
: :exc:<code>~werkzeug.routing.BuildError</code>.  Each function registered here
: is called with <code>error</code>, <code>endpoint</code> and <code>values</code>.  If a function
: returns <code>None</code> or raises a <code>BuildError</code> the next function is
: tried.
:
: .. versionadded:: 0.9</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">url_build_error_handlers</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>: A dictionary with lists of functions that should be called at the
: beginning of the request.  The key of the dictionary is the name of
: the blueprint this function is active for, <code>None</code> for all requests.
: This can for example be used to open database connections or
: getting hold of the currently logged in user.  To register a
: function here, use the :meth:<code>before_request</code> decorator.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">before_request_funcs</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>: A lists of functions that should be called at the beginning of the
: first request to this instance.  To register a function here, use
: the :meth:<code>before_first_request</code> decorator.
:
: .. versionadded:: 0.8</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">before_first_request_funcs</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>: A dictionary with lists of functions that should be called after
: each request.  The key of the dictionary is the name of the blueprint
: this function is active for, <code>None</code> for all requests.  This can for
: example be used to open database connections or getting hold of the
: currently logged in user.  To register a function here, use the
: :meth:<code>after_request</code> decorator.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">after_request_funcs</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p>: A dictionary with lists of functions that are called after
: each request, even if an exception has occurred. The key of the
: dictionary is the name of the blueprint this function is active for,
: <code>None</code> for all requests. These functions are not allowed to modify
: the request, and their return values are ignored. If an exception
: occurred while processing the request, it gets passed to each
: teardown_request function. To register a function here, use the
: :meth:<code>teardown_request</code> decorator.
:
: .. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">teardown_request_funcs</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>: A list of functions that are called when the application context
: is destroyed.  Since the application context is also torn down
: if the request ends this is the place to store code that disconnects
: from databases.
:
: .. versionadded:: 0.9</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">teardown_appcontext_funcs</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>: A dictionary with lists of functions that can be used as URL
: value processor functions.  Whenever a URL is built these functions
: are called to modify the dictionary of values in place.  The key
: <code>None</code> here is used for application wide
: callbacks, otherwise the key is the name of the blueprint.
: Each of these functions has the chance to modify the dictionary
:
: .. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">url_value_preprocessors</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>: A dictionary with lists of functions that can be used as URL value
: preprocessors.  The key <code>None</code> here is used for application wide
: callbacks, otherwise the key is the name of the blueprint.
: Each of these functions has the chance to modify the dictionary
: of URL values before they are used as the keyword arguments of the
: view function.  For each function registered this one should also
: provide a :meth:<code>url_defaults</code> function that adds the parameters
: automatically again that were removed that way.
:
: .. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">url_default_functions</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>: A dictionary with list of functions that are called without argument
: to populate the template context.  The key of the dictionary is the
: name of the blueprint this function is active for, <code>None</code> for all
: requests.  Each returns a dictionary that the template context is
: updated with.  To register a function here, use the
: :meth:<code>context_processor</code> decorator.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">template_context_processors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">None</span><span class="p">:</span> <span class="p">[</span><span class="n">_default_template_ctx_processor</span><span class="p">]</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>: all the attached blueprints in a directory by name.  Blueprints
: can be attached multiple times so this dictionary does not tell
: you how often they got attached.
:
: .. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">blueprints</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>: a place where extensions can store application specific state.  For
: example this is where an extension could store database engines and
: similar things.  For backwards compatibility extensions should register
: themselves like this::
:
:      if not hasattr(app, 'extensions'):
:          app.extensions = {}
:      app.extensions['extensionname'] = SomeObject()
:
: The key must match the name of the <code>flaskext</code> module.  For example in
: case of a "Flask-Foo" extension in <code>flaskext.foo</code>, the key would be
: <code>'foo'</code>.
:
: .. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">extensions</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p>: The :class:<code>~werkzeug.routing.Map</code> for this instance.  You can use
: this to change the routing converters after the class was created
: but before any routes are connected.  Example::
:
:    from werkzeug.routing import BaseConverter
:
:    class ListConverter(BaseConverter):
:        def to_python(self, value):
:            return value.split(',')
:        def to_url(self, values):
:            return ','.join(BaseConverter.to_url(value)
:                            for value in values)
:
:    app = Flask(<strong>name</strong>)
:    app.url_map.converters['list'] = ListConverter</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">url_map</span> <span class="o">=</span> <span class="n">Map</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p>tracks internally if the application already handled at least one
request.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_got_first_request</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_before_request_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p>register the static folder for the application.  Do that even
if the folder does not exist.  First of all it might be created
while the server is running (usually happens during development)
but also because google appengine stores static files somewhere
else when mapped with the .yml file.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_static_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">static_url_path</span> <span class="o">+</span> <span class="s">&#39;/&lt;path:filename&gt;&#39;</span><span class="p">,</span>
                              <span class="n">endpoint</span><span class="o">=</span><span class="s">&#39;static&#39;</span><span class="p">,</span>
                              <span class="n">view_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">send_static_file</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_get_error_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
        <span class="n">warn</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s">&#39;error_handlers is deprecated, use the &#39;</span>
            <span class="s">&#39;new error_handler_spec attribute instead.&#39;</span><span class="p">),</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error_handlers</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_set_error_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error_handlers</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler_spec</span><span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">error_handlers</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_error_handlers</span><span class="p">,</span> <span class="n">_set_error_handlers</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">_get_error_handlers</span><span class="p">,</span> <span class="n">_set_error_handlers</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <p>The name of the application.  This is usually the import name</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@locked_cached_property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>with the difference that it's guessed from the run file if the
import name is main.  This name is used as a display name when
Flask needs the name of the application.  It can be set and overriden
to change the value.</p>
<p>.. versionadded:: 0.8</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_name</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s">&#39;__main__&#39;</span><span class="p">],</span> <span class="s">&#39;__file__&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;__main__&#39;</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_name</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <p>Returns the value of the <code>PROPAGATE_EXCEPTIONS</code> configuration</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">propagate_exceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      <p>value in case it's set, otherwise a sensible default is returned.</p>
<p>.. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;PROPAGATE_EXCEPTIONS&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rv</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">testing</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      <p>Returns the value of the <code>PRESERVE_CONTEXT_ON_EXCEPTION</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">preserve_context_on_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <p>configuration value in case it's set, otherwise a sensible default
is returned.</p>
<p>.. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;PRESERVE_CONTEXT_ON_EXCEPTION&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rv</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      <p>A :class:<code>logging.Logger</code> object for this application.  The</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-58'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-58'>#</a>
      </div>
      <p>default configuration is to log to stderr if the application is
in debug mode.  This logger can be used to (surprise) log messages.
Here some examples::</p>
<pre><code>app.logger.debug('A value for debugging')
app.logger.warning('A warning occurred (%d apples)', 42)
app.logger.error('An error occurred')
</code></pre>
<p>.. versionadded:: 0.3</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>
        <span class="k">with</span> <span class="n">_logger_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>
            <span class="kn">from</span> <span class="nn">flask.logging</span> <span class="kn">import</span> <span class="n">create_logger</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">rv</span> <span class="o">=</span> <span class="n">create_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">rv</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-59'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-59'>#</a>
      </div>
      <p>The Jinja2 environment used to load templates.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@locked_cached_property</span>
    <span class="k">def</span> <span class="nf">jinja_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-60'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-60'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_jinja_environment</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-61'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-61'>#</a>
      </div>
      <p>Hack to support the init_jinja_globals method which is supported
until 1.0 but has an API deficiency.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_jinja_globals</span><span class="p">,</span> <span class="s">&#39;im_func&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> \
           <span class="n">Flask</span><span class="o">.</span><span class="n">init_jinja_globals</span><span class="o">.</span><span class="n">im_func</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
            <span class="n">warn</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s">&#39;This flask class uses a customized &#39;</span>
                <span class="s">&#39;init_jinja_globals() method which is deprecated. &#39;</span>
                <span class="s">&#39;Move the code from that method into the &#39;</span>
                <span class="s">&#39;create_jinja_environment() method instead.&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;jinja_env&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rv</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_jinja_globals</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">rv</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-62'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-62'>#</a>
      </div>
      <p>This attribute is set to <code>True</code> if the application started</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">got_first_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-63'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-63'>#</a>
      </div>
      <p>handling the first request.</p>
<p>.. versionadded:: 0.8</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_got_first_request</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-64'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-64'>#</a>
      </div>
      <p>Used to create the config attribute by the Flask constructor.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">make_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance_relative</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-65'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-65'>#</a>
      </div>
      <p>The <code>instance_relative</code> parameter is passed in from the constructor
of Flask (there named <code>instance_relative_config</code>) and indicates if
the config should be relative to the instance path or the root path
of the application.</p>
<p>.. versionadded:: 0.8</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_path</span>
        <span class="k">if</span> <span class="n">instance_relative</span><span class="p">:</span>
            <span class="n">root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_path</span>
        <span class="k">return</span> <span class="n">Config</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_config</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-66'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-66'>#</a>
      </div>
      <p>Tries to locate the instance path if it was not provided to the</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">auto_find_instance_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-67'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-67'>#</a>
      </div>
      <p>constructor of the application class.  It will basically calculate
the path to a folder named <code>instance</code> next to your main file or
the package.</p>
<p>.. versionadded:: 0.8</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">prefix</span><span class="p">,</span> <span class="n">package_path</span> <span class="o">=</span> <span class="n">find_package</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">import_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">package_path</span><span class="p">,</span> <span class="s">&#39;instance&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s">&#39;var&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;-instance&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-68'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-68'>#</a>
      </div>
      <p>Opens a resource from the application's instance folder</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">open_instance_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;rb&#39;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-69'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-69'>#</a>
      </div>
      <p>(:attr:<code>instance_path</code>).  Otherwise works like
:meth:<code>open_resource</code>.  Instance resources can also be opened for
writing.</p>
<p>:param resource: the name of the resource.  To access resources within
                 subfolders use forward slashes as separator.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance_path</span><span class="p">,</span> <span class="n">resource</span><span class="p">),</span> <span class="n">mode</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-70'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-70'>#</a>
      </div>
      <p>Creates the Jinja2 environment based on :attr:<code>jinja_options</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">create_jinja_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-71'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-71'>#</a>
      </div>
      <p>and :meth:<code>select_jinja_autoescape</code>.  Since 0.7 this also adds
the Jinja2 globals and filters after initialization.  Override
this function to customize the behavior.</p>
<p>.. versionadded:: 0.5</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jinja_options</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;autoescape&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s">&#39;autoescape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_jinja_autoescape</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="n">rv</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">url_for</span><span class="o">=</span><span class="n">url_for</span><span class="p">,</span>
            <span class="n">get_flashed_messages</span><span class="o">=</span><span class="n">get_flashed_messages</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-72'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-72'>#</a>
      </div>
      <p>request, session and g are normally added with the
context processor for efficiency reasons but for imported
templates we also want the proxies in there.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
            <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
            <span class="n">g</span><span class="o">=</span><span class="n">g</span>
        <span class="p">)</span>
        <span class="n">rv</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s">&#39;tojson&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">htmlsafe_dumps</span>
        <span class="k">return</span> <span class="n">rv</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-73'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-73'>#</a>
      </div>
      <p>Creates the loader for the Jinja2 environment.  Can be used to</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">create_global_jinja_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-74'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-74'>#</a>
      </div>
      <p>override just the loader and keeping the rest unchanged.  It's
discouraged to override this function.  Instead one should override
the :meth:<code>jinja_loader</code> function instead.</p>
<p>The global loader dispatches between the loaders of the application
and the individual blueprints.</p>
<p>.. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">DispatchingJinjaLoader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-75'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-75'>#</a>
      </div>
      <p>Deprecated.  Used to initialize the Jinja2 globals.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">init_jinja_globals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-76'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-76'>#</a>
      </div>
      <p>.. versionadded:: 0.5
.. versionchanged:: 0.7
   This method is deprecated with 0.7.  Override
   :meth:<code>create_jinja_environment</code> instead.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-77'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-77'>#</a>
      </div>
      <p>Returns <code>True</code> if autoescaping should be active for the given</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">select_jinja_autoescape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-78'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-78'>#</a>
      </div>
      <p>template name.</p>
<p>.. versionadded:: 0.5</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s">&#39;.html&#39;</span><span class="p">,</span> <span class="s">&#39;.htm&#39;</span><span class="p">,</span> <span class="s">&#39;.xml&#39;</span><span class="p">,</span> <span class="s">&#39;.xhtml&#39;</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-79'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-79'>#</a>
      </div>
      <p>Update the template context with some commonly used variables.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">update_template_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-80'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-80'>#</a>
      </div>
      <p>This injects request, session, config and g into the template
context as well as everything template context processors want
to inject.  Note that the as of Flask 0.6, the original values
in the context will not be overriden if a context processor
decides to return a value with the same key.</p>
<p>:param context: the context as a dictionary that is updated in place
                to add extra variables.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_context_processors</span><span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">reqctx</span> <span class="o">=</span> <span class="n">_request_ctx_stack</span><span class="o">.</span><span class="n">top</span>
        <span class="k">if</span> <span class="n">reqctx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">bp</span> <span class="o">=</span> <span class="n">reqctx</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">blueprint</span>
            <span class="k">if</span> <span class="n">bp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">bp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_context_processors</span><span class="p">:</span>
                <span class="n">funcs</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_context_processors</span><span class="p">[</span><span class="n">bp</span><span class="p">])</span>
        <span class="n">orig_ctx</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">func</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-81'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-81'>#</a>
      </div>
      <p>make sure the original values win.  This makes it possible to
easier add new variables in context processors without breaking
existing views.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">orig_ctx</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-82'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-82'>#</a>
      </div>
      <p>Runs the application on a local development server.  If the</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-83'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-83'>#</a>
      </div>
      <p>:attr:<code>debug</code> flag is set the server will automatically reload
for code changes and show a debugger in case an exception happened.</p>
<p>If you want to run the application in debug mode, but disable the
code execution on the interactive debugger, you can pass
<code>use_evalex=False</code> as parameter.  This will keep the debugger's
traceback screen active, but disable code execution.</p>
<p>.. admonition:: Keep in Mind</p>
<p>Flask will suppress any server error with a generic error page
   unless it is in debug mode.  As such to enable just the
   interactive debugger without the code reloading, you have to
   invoke :meth:<code>run</code> with <code>debug=True</code> and <code>use_reloader=False</code>.
   Setting <code>use_debugger</code> to <code>True</code> without being in debug mode
   won't catch any exceptions because there won't be any to
   catch.</p>
<p>:param host: the hostname to listen on. Set this to <code>'0.0.0.0'</code> to
             have the server available externally as well. Defaults to
             <code>'127.0.0.1'</code>.
:param port: the port of the webserver. Defaults to <code>5000</code>.
:param debug: if given, enable or disable debug mode.
              See :attr:<code>debug</code>.
:param options: the options to be forwarded to the underlying
                Werkzeug server.  See
                :func:<code>werkzeug.serving.run_simple</code> for more
                information.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="kn">from</span> <span class="nn">werkzeug.serving</span> <span class="kn">import</span> <span class="n">run_simple</span>
        <span class="k">if</span> <span class="n">host</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">host</span> <span class="o">=</span> <span class="s">&#39;127.0.0.1&#39;</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="mi">5000</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;use_reloader&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;use_debugger&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">run_simple</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-84'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-84'>#</a>
      </div>
      <p>reset the first request information if the development server
resetted normally.  This makes it possible to restart the server
without reloader and that stuff from an interactive shell.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">_got_first_request</span> <span class="o">=</span> <span class="bp">False</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-85'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-85'>#</a>
      </div>
      <p>Creates a test client for this application.  For information</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_cookies</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-86'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-86'>#</a>
      </div>
      <p>about unit testing head over to :ref:<code>testing</code>.</p>
<p>Note that if you are testing for assertions or exceptions in your
application code, you must set <code>app.testing = True</code> in order for the
exceptions to propagate to the test client.  Otherwise, the exception
will be handled by the application (not visible to the test client) and
the only indication of an AssertionError or other exception will be a
500 status code response to the test client.  See the :attr:<code>testing</code>
attribute.  For example::</p>
<pre><code>app.testing = True
client = app.test_client()
</code></pre>
<p>The test client can be used in a <code>with</code> block to defer the closing down
of the context until the end of the <code>with</code> block.  This is useful if
you want to access the context locals for testing::</p>
<pre><code>with app.test_client() as c:
    rv = c.get('/?vodka=42')
    assert request.args['vodka'] == '42'
</code></pre>
<p>See :class:<code>~flask.testing.FlaskClient</code> for more information.</p>
<p>.. versionchanged:: 0.4
   added support for <code>with</code> block usage for the client.</p>
<p>.. versionadded:: 0.7
   The <code>use_cookies</code> parameter was added as well as the ability
   to override the client to be used by setting the
   :attr:<code>test_client_class</code> attribute.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_client_class</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">flask.testing</span> <span class="kn">import</span> <span class="n">FlaskClient</span> <span class="k">as</span> <span class="n">cls</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_class</span><span class="p">,</span> <span class="n">use_cookies</span><span class="o">=</span><span class="n">use_cookies</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-87'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-87'>#</a>
      </div>
      <p>Creates or opens a new session.  Default implementation stores all</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">open_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-88'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-88'>#</a>
      </div>
      <p>session data in a signed cookie.  This requires that the
:attr:<code>secret_key</code> is set.  Instead of overriding this method
we recommend replacing the :class:<code>session_interface</code>.</p>
<p>:param request: an instance of :attr:<code>request_class</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_interface</span><span class="o">.</span><span class="n">open_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-89'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-89'>#</a>
      </div>
      <p>Saves the session if it needs updates.  For the default</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">save_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-90'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-90'>#</a>
      </div>
      <p>implementation, check :meth:<code>open_session</code>.  Instead of overriding this
method we recommend replacing the :class:<code>session_interface</code>.</p>
<p>:param session: the session to be saved (a
                :class:<code>~werkzeug.contrib.securecookie.SecureCookie</code>
                object)
:param response: an instance of :attr:<code>response_class</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_interface</span><span class="o">.</span><span class="n">save_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-91'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-91'>#</a>
      </div>
      <p>Creates a new instance of a missing session.  Instead of overriding</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">make_null_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-92'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-92'>#</a>
      </div>
      <p>this method we recommend replacing the :class:<code>session_interface</code>.</p>
<p>.. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_interface</span><span class="o">.</span><span class="n">make_null_session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-93'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-93'>#</a>
      </div>
      <p>Registers a module with this application.  The keyword argument</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">register_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-94'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-94'>#</a>
      </div>
      <p>of this function are the same as the ones for the constructor of the
:class:<code>Module</code> class and will override the values of the module if
provided.</p>
<p>.. versionchanged:: 0.7
   The module system was deprecated in favor for the blueprint
   system.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">assert</span> <span class="n">blueprint_is_module</span><span class="p">(</span><span class="n">module</span><span class="p">),</span> <span class="s">&#39;register_module requires &#39;</span> \
            <span class="s">&#39;actual module objects.  Please upgrade to blueprints though.&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_modules</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Module support was disabled but code &#39;</span>
                <span class="s">&#39;attempted to register a module named </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">module</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
            <span class="n">warn</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s">&#39;Modules are deprecated.  Upgrade to &#39;</span>
                <span class="s">&#39;using blueprints.  Have a look into the documentation for &#39;</span>
                <span class="s">&#39;more information.  If this module was registered by a &#39;</span>
                <span class="s">&#39;Flask-Extension upgrade the extension or contact the author &#39;</span>
                <span class="s">&#39;of that extension instead.  (Registered </span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">module</span><span class="p">),</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-95'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-95'>#</a>
      </div>
      <p>Registers a blueprint on the application.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">register_blueprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blueprint</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-96'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-96'>#</a>
      </div>
      <p>.. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">first_registration</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">blueprint</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blueprints</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">blueprints</span><span class="p">[</span><span class="n">blueprint</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="ow">is</span> <span class="n">blueprint</span><span class="p">,</span> \
                <span class="s">&#39;A blueprint</span><span class="se">\&#39;</span><span class="s">s name collision occurred between </span><span class="si">%r</span><span class="s"> and &#39;</span> \
                <span class="s">&#39;</span><span class="si">%r</span><span class="s">.  Both share the same name &quot;</span><span class="si">%s</span><span class="s">&quot;.  Blueprints that &#39;</span> \
                <span class="s">&#39;are created on the fly need unique names.&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">blueprint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blueprints</span><span class="p">[</span><span class="n">blueprint</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">blueprint</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blueprints</span><span class="p">[</span><span class="n">blueprint</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">blueprint</span>
            <span class="n">first_registration</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">blueprint</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">first_registration</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-97'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-97'>#</a>
      </div>
      <p>Connects a URL rule.  Works exactly like the :meth:<code>route</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">add_url_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-98'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-98'>#</a>
      </div>
      <p>decorator.  If a view_func is provided it will be registered with the
endpoint.</p>
<p>Basically this example::</p>
<pre><code>@app.route('/')
def index():
    pass
</code></pre>
<p>Is equivalent to the following::</p>
<pre><code>def index():
    pass
app.add_url_rule('/', 'index', index)
</code></pre>
<p>If the view_func is not provided you will need to connect the endpoint
to a view function like so::</p>
<pre><code>app.view_functions['index'] = index
</code></pre>
<p>Internally :meth:<code>route</code> invokes :meth:<code>add_url_rule</code> so if you want
to customize the behavior via subclassing you only need to change
this method.</p>
<p>For more information refer to :ref:<code>url-route-registrations</code>.</p>
<p>.. versionchanged:: 0.2
   <code>view_func</code> parameter added.</p>
<p>.. versionchanged:: 0.6
   <code>OPTIONS</code> is added automatically as method.</p>
<p>:param rule: the URL rule as string
:param endpoint: the endpoint for the registered URL rule.  Flask
                 itself assumes the name of the view function as
                 endpoint
:param view_func: the function to call when serving a request to the
                  provided endpoint
:param options: the options to be forwarded to the underlying
                :class:<code>~werkzeug.routing.Rule</code> object.  A change
                to Werkzeug is handling of method options.  methods
                is a list of methods this rule should be limited
                to (<code>GET</code>, <code>POST</code> etc.).  By default a rule
                just listens for <code>GET</code> (and implicitly <code>HEAD</code>).
                Starting with Flask 0.6, <code>OPTIONS</code> is implicitly
                added and handled by the standard request handling.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="n">_endpoint_from_view_func</span><span class="p">(</span><span class="n">view_func</span><span class="p">)</span>
        <span class="n">options</span><span class="p">[</span><span class="s">&#39;endpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">endpoint</span>
        <span class="n">methods</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;methods&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-99'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-99'>#</a>
      </div>
      <p>if the methods are not given and the view_func object knows its
methods we can use that instead.  If neither exists, we go with
a tuple of only <code>GET</code> as default.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">methods</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">view_func</span><span class="p">,</span> <span class="s">&#39;methods&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s">&#39;GET&#39;</span><span class="p">,)</span>
        <span class="n">methods</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-100'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-100'>#</a>
      </div>
      <p>Methods that should always be added</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">required_methods</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">view_func</span><span class="p">,</span> <span class="s">&#39;required_methods&#39;</span><span class="p">,</span> <span class="p">()))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-101'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-101'>#</a>
      </div>
      <p>starting with Flask 0.8 the view_func object can disable and
force-enable the automatic options handling.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">provide_automatic_options</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">view_func</span><span class="p">,</span>
            <span class="s">&#39;provide_automatic_options&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">provide_automatic_options</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;OPTIONS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
                <span class="n">provide_automatic_options</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">required_methods</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;OPTIONS&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">provide_automatic_options</span> <span class="o">=</span> <span class="bp">False</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-102'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-102'>#</a>
      </div>
      <p>Add the required methods now.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">methods</span> <span class="o">|=</span> <span class="n">required_methods</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-103'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-103'>#</a>
      </div>
      <p>due to a werkzeug bug we need to make sure that the defaults are
None if they are an empty dictionary.  This should not be necessary
with Werkzeug 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">options</span><span class="p">[</span><span class="s">&#39;defaults&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;defaults&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span>

        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_rule_class</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="n">methods</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="n">rule</span><span class="o">.</span><span class="n">provide_automatic_options</span> <span class="o">=</span> <span class="n">provide_automatic_options</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">view_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">old_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view_functions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">old_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">old_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">view_func</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;View function mapping is overwriting an &#39;</span>
                                     <span class="s">&#39;existing endpoint function: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">endpoint</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view_functions</span><span class="p">[</span><span class="n">endpoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">view_func</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-104'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-104'>#</a>
      </div>
      <p>A decorator that is used to register a view function for a</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-105'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-105'>#</a>
      </div>
      <p>given URL rule.  This does the same thing as :meth:<code>add_url_rule</code>
but is intended for decorator usage::</p>
<pre><code>@app.route('/')
def index():
    return 'Hello World'
</code></pre>
<p>For more information refer to :ref:<code>url-route-registrations</code>.</p>
<p>:param rule: the URL rule as string
:param endpoint: the endpoint for the registered URL rule.  Flask
                 itself assumes the name of the view function as
                 endpoint
:param view_func: the function to call when serving a request to the
                  provided endpoint
:param options: the options to be forwarded to the underlying
                :class:<code>~werkzeug.routing.Rule</code> object.  A change
                to Werkzeug is handling of method options.  methods
                is a list of methods this rule should be limited
                to (<code>GET</code>, <code>POST</code> etc.).  By default a rule
                just listens for <code>GET</code> (and implicitly <code>HEAD</code>).
                Starting with Flask 0.6, <code>OPTIONS</code> is implicitly
                added and handled by the standard request handling.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;endpoint&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="k">return</span> <span class="n">decorator</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-106'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-106'>#</a>
      </div>
      <p>A decorator to register a function as an endpoint.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-107'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-107'>#</a>
      </div>
      <p>Example::</p>
<pre><code>@app.endpoint('example.endpoint')
def example():
    return "example"
</code></pre>
<p>:param endpoint: the name of the endpoint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view_functions</span><span class="p">[</span><span class="n">endpoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="k">return</span> <span class="n">decorator</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-108'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-108'>#</a>
      </div>
      <p>A decorator that is used to register a function give a given</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">errorhandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code_or_exception</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-109'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-109'>#</a>
      </div>
      <p>error code.  Example::</p>
<pre><code>@app.errorhandler(404)
def page_not_found(error):
    return 'This page does not exist', 404
</code></pre>
<p>You can also register handlers for arbitrary exceptions::</p>
<pre><code>@app.errorhandler(DatabaseError)
def special_exception_handler(error):
    return 'Database connection failed', 500
</code></pre>
<p>You can also register a function as error handler without using
the :meth:<code>errorhandler</code> decorator.  The following example is
equivalent to the one above::</p>
<pre><code>def page_not_found(error):
    return 'This page does not exist', 404
app.error_handler_spec[None][404] = page_not_found
</code></pre>
<p>Setting error handlers via assignments to :attr:<code>error_handler_spec</code>
however is discouraged as it requires fidling with nested dictionaries
and the special case for arbitrary exception types.</p>
<p>The first <code>None</code> refers to the active blueprint.  If the error
handler should be application wide <code>None</code> shall be used.</p>
<p>.. versionadded:: 0.7
   One can now additionally also register custom exception types
   that do not necessarily have to be a subclass of the
   :class:<code>~werkzeug.exceptions.HTTPException</code> class.</p>
<p>:param code: the code as integer for the handler</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_register_error_handler</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">code_or_exception</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="k">return</span> <span class="n">decorator</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-110'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-110'>#</a>
      </div>
      <p>Alternative error attach function to the :meth:<code>errorhandler</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">register_error_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code_or_exception</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-111'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-111'>#</a>
      </div>
      <p>decorator that is more straightforward to use for non decorator
usage.</p>
<p>.. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_register_error_handler</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">code_or_exception</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-112'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-112'>#</a>
      </div>
      <p>A decorator that is used to register custom template filter.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">_register_error_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">code_or_exception</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code_or_exception</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">):</span>
            <span class="n">code_or_exception</span> <span class="o">=</span> <span class="n">code_or_exception</span><span class="o">.</span><span class="n">code</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code_or_exception</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">)):</span>
            <span class="k">assert</span> <span class="n">code_or_exception</span> <span class="o">!=</span> <span class="mi">500</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span> \
                <span class="s">&#39;It is currently not possible to register a 500 internal &#39;</span> \
                <span class="s">&#39;server error on a per-blueprint level.&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_handler_spec</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})[</span><span class="n">code_or_exception</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_handler_spec</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">[])</span> \
                <span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">code_or_exception</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>

    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">template_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-113'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-113'>#</a>
      </div>
      <p>You can specify a name for the filter, otherwise the function
name will be used. Example::</p>
<p>@app.template_filter()
  def reverse(s):
      return s[::-1]</p>
<p>:param name: the optional name of the filter, otherwise the
             function name will be used.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_template_filter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="k">return</span> <span class="n">decorator</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-114'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-114'>#</a>
      </div>
      <p>Register a custom template filter.  Works exactly like the</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">add_template_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-115'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-115'>#</a>
      </div>
      <p>:meth:<code>template_filter</code> decorator.</p>
<p>:param name: the optional name of the filter, otherwise the
             function name will be used.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">jinja_env</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">name</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-116'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-116'>#</a>
      </div>
      <p>A decorator that is used to register custom template test.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">template_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-117'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-117'>#</a>
      </div>
      <p>You can specify a name for the test, otherwise the function
name will be used. Example::</p>
<p>@app.template_test()
  def is_prime(n):
      if n == 2:
          return True
      for i in xrange(2, int(math.ceil(math.sqrt(n))) + 1):
          if n % i == 0:
              return False
      return True</p>
<p>.. versionadded:: 0.10</p>
<p>:param name: the optional name of the test, otherwise the
             function name will be used.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_template_test</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="k">return</span> <span class="n">decorator</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-118'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-118'>#</a>
      </div>
      <p>Register a custom template test.  Works exactly like the</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">add_template_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-119'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-119'>#</a>
      </div>
      <p>:meth:<code>template_test</code> decorator.</p>
<p>.. versionadded:: 0.10</p>
<p>:param name: the optional name of the test, otherwise the
             function name will be used.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">jinja_env</span><span class="o">.</span><span class="n">tests</span><span class="p">[</span><span class="n">name</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-120'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-120'>#</a>
      </div>
      <p>A decorator that is used to register a custom template global function.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">template_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-121'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-121'>#</a>
      </div>
      <p>You can specify a name for the global function, otherwise the function
name will be used. Example::</p>
<p>@app.template_global()
def double(n):
    return 2 * n</p>
<p>.. versionadded:: 0.10</p>
<p>:param name: the optional name of the global function, otherwise the
function name will be used.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_template_global</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="k">return</span> <span class="n">decorator</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-122'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-122'>#</a>
      </div>
      <p>Register a custom template global function. Works exactly like the</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">add_template_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-123'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-123'>#</a>
      </div>
      <p>:meth:<code>template_global</code> decorator.</p>
<p>.. versionadded:: 0.10</p>
<p>:param name: the optional name of the global function, otherwise the
function name will be used.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">jinja_env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="n">name</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-124'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-124'>#</a>
      </div>
      <p>Registers a function to run before each request.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">before_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-125'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-125'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">before_request_funcs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-126'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-126'>#</a>
      </div>
      <p>Registers a function to be run before the first request to this</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">before_first_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-127'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-127'>#</a>
      </div>
      <p>instance of the application.</p>
<p>.. versionadded:: 0.8</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">before_first_request_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-128'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-128'>#</a>
      </div>
      <p>Register a function to be run after each request.  Your function</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">after_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-129'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-129'>#</a>
      </div>
      <p>must take one parameter, a :attr:<code>response_class</code> object and return
a new response object or the same (see :meth:<code>process_response</code>).</p>
<p>As of Flask 0.7 this function might not be executed at the end of the
request in case an unhandled exception occurred.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">after_request_funcs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-130'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-130'>#</a>
      </div>
      <p>Register a function to be run at the end of each request,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">teardown_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-131'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-131'>#</a>
      </div>
      <p>regardless of whether there was an exception or not.  These functions
are executed when the request context is popped, even if not an
actual request was performed.</p>
<p>Example::</p>
<pre><code>ctx = app.test_request_context()
ctx.push()
...
ctx.pop()
</code></pre>
<p>When <code>ctx.pop()</code> is executed in the above example, the teardown
functions are called just before the request context moves from the
stack of active contexts.  This becomes relevant if you are using
such constructs in tests.</p>
<p>Generally teardown functions must take every necessary step to avoid
that they will fail.  If they do execute code that might fail they
will have to surround the execution of these code by try/except
statements and log occurring errors.</p>
<p>When a teardown function was called because of a exception it will
be passed an error object.</p>
<p>.. admonition:: Debug Note</p>
<p>In debug mode Flask will not tear down a request on an exception
   immediately.  Instead if will keep it alive so that the interactive
   debugger can still access it.  This behavior can be controlled
   by the <code>PRESERVE_CONTEXT_ON_EXCEPTION</code> configuration variable.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">teardown_request_funcs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-132'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-132'>#</a>
      </div>
      <p>Registers a function to be called when the application context</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">teardown_appcontext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-133'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-133'>#</a>
      </div>
      <p>ends.  These functions are typically also called when the request
context is popped.</p>
<p>Example::</p>
<pre><code>ctx = app.app_context()
ctx.push()
...
ctx.pop()
</code></pre>
<p>When <code>ctx.pop()</code> is executed in the above example, the teardown
functions are called just before the app context moves from the
stack of active contexts.  This becomes relevant if you are using
such constructs in tests.</p>
<p>Since a request context typically also manages an application
context it would also be called when you pop a request context.</p>
<p>When a teardown function was called because of an exception it will
be passed an error object.</p>
<p>.. versionadded:: 0.9</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">teardown_appcontext_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-134'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-134'>#</a>
      </div>
      <p>Registers a template context processor function.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">context_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-135'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-135'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">template_context_processors</span><span class="p">[</span><span class="bp">None</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-136'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-136'>#</a>
      </div>
      <p>Registers a function as URL value preprocessor for all view</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">url_value_preprocessor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-137'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-137'>#</a>
      </div>
      <p>functions of the application.  It's called before the view functions
are called and can modify the url values provided.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">url_value_preprocessors</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-138'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-138'>#</a>
      </div>
      <p>Callback function for URL defaults for all view functions of the</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@setupmethod</span>
    <span class="k">def</span> <span class="nf">url_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-139'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-139'>#</a>
      </div>
      <p>application.  It's called with the endpoint and values and should
update the values passed in place.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">url_default_functions</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-140'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-140'>#</a>
      </div>
      <p>Handles an HTTP exception.  By default this will invoke the</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_http_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-141'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-141'>#</a>
      </div>
      <p>registered error handlers and fall back to returning the
exception as response.</p>
<p>.. versionadded:: 0.3</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">handlers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_handler_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">blueprint</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-142'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-142'>#</a>
      </div>
      <p>Proxy exceptions don't have error codes.  We want to always return
those unchanged as errors</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">e</span>
        <span class="k">if</span> <span class="n">handlers</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="ow">in</span> <span class="n">handlers</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">handlers</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_handler_spec</span><span class="p">[</span><span class="bp">None</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">e</span>
        <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-143'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-143'>#</a>
      </div>
      <p>Checks if an HTTP exception should be trapped or not.  By default</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">trap_http_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-144'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-144'>#</a>
      </div>
      <p>this will return <code>False</code> for all exceptions except for a bad request
key error if <code>TRAP_BAD_REQUEST_ERRORS</code> is set to <code>True</code>.  It
also returns <code>True</code> if <code>TRAP_HTTP_EXCEPTIONS</code> is set to <code>True</code>.</p>
<p>This is called for all HTTP exceptions raised by a view function.
If it returns <code>True</code> for any exception the error handler for this
exception is not called and it shows up as regular exception in the
traceback.  This is helpful for debugging implicitly raised HTTP
exceptions.</p>
<p>.. versionadded:: 0.8</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;TRAP_HTTP_EXCEPTIONS&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;TRAP_BAD_REQUEST_ERRORS&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">BadRequest</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-145'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-145'>#</a>
      </div>
      <p>This method is called whenever an exception occurs that should be</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_user_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-146'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-146'>#</a>
      </div>
      <p>handled.  A special case are
:class:<code>~werkzeug.exception.HTTPException</code>\s which are forwarded by
this function to the :meth:<code>handle_http_exception</code> method.  This
function will either return a response value or reraise the
exception with the same traceback.</p>
<p>.. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="n">e</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-147'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-147'>#</a>
      </div>
      <p>ensure not to trash sys.exc_info() at that point in case someone
wants the traceback preserved in handle_http_exception.  Of course
we cannot prevent users from trashing it themselves in a custom
trap_http_exception method so that's their fault then.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trap_http_exception</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_http_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="n">blueprint_handlers</span> <span class="o">=</span> <span class="p">()</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_handler_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">blueprint</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handlers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">blueprint_handlers</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">())</span>
        <span class="n">app_handlers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_handler_spec</span><span class="p">[</span><span class="bp">None</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">())</span>
        <span class="k">for</span> <span class="n">typecheck</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="n">blueprint_handlers</span><span class="p">,</span> <span class="n">app_handlers</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">typecheck</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-148'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-148'>#</a>
      </div>
      <p>Default exception handling that kicks in when an exception</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-149'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-149'>#</a>
      </div>
      <p>occurs that is not caught.  In debug mode the exception will
be re-raised immediately, otherwise it is logged and the handler
for a 500 internal server error is used.  If no such handler
exists, a default 500 internal server error message is displayed.</p>
<p>.. versionadded:: 0.3</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>

        <span class="n">got_request_exception</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_handler_spec</span><span class="p">[</span><span class="bp">None</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate_exceptions</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-150'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-150'>#</a>
      </div>
      <p>if we want to repropagate the exception, we can attempt to
raise it with the whole traceback in case we can do that
(the function was actually called from the except part)
otherwise, we just raise the error again</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log_exception</span><span class="p">((</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">InternalServerError</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-151'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-151'>#</a>
      </div>
      <p>Logs an exception.  This is called by :meth:<code>handle_exception</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">log_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-152'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-152'>#</a>
      </div>
      <p>if debugging is disabled and right before the handler is called.
The default implementation logs the exception as error on the
:attr:<code>logger</code>.</p>
<p>.. versionadded:: 0.8</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Exception on </span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="n">request</span><span class="o">.</span><span class="n">method</span>
        <span class="p">),</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">exc_info</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-153'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-153'>#</a>
      </div>
      <p>Exceptions that are recording during routing are reraised with</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">raise_routing_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-154'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-154'>#</a>
      </div>
      <p>this method.  During debug we are not reraising redirect requests
for non <code>GET</code>, <code>HEAD</code>, or <code>OPTIONS</code> requests and we're raising
a different error instead to help debug situations.</p>
<p>:internal:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> \
           <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">routing_exception</span><span class="p">,</span> <span class="n">RequestRedirect</span><span class="p">)</span> \
           <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;HEAD&#39;</span><span class="p">,</span> <span class="s">&#39;OPTIONS&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">request</span><span class="o">.</span><span class="n">routing_exception</span>

        <span class="kn">from</span> <span class="nn">.debughelpers</span> <span class="kn">import</span> <span class="n">FormDataRoutingRedirect</span>
        <span class="k">raise</span> <span class="n">FormDataRoutingRedirect</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-155'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-155'>#</a>
      </div>
      <p>Does the request dispatching.  Matches the URL and returns the</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-156'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-156'>#</a>
      </div>
      <p>return value of the view or error handler.  This does not have to
be a response object.  In order to convert the return value to a
proper response object, call :func:<code>make_response</code>.</p>
<p>.. versionchanged:: 0.7
   This no longer does the exception handling, this code was
   moved to the new :meth:<code>full_dispatch_request</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">req</span> <span class="o">=</span> <span class="n">_request_ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">request</span>
        <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">routing_exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_routing_exception</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">url_rule</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-157'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-157'>#</a>
      </div>
      <p>if we provide automatic options for this URL and the
request came with the OPTIONS method, reply automatically</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="s">&#39;provide_automatic_options&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> \
           <span class="ow">and</span> <span class="n">req</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_default_options_response</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-158'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-158'>#</a>
      </div>
      <p>otherwise dispatch to the handler for that endpoint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view_functions</span><span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">endpoint</span><span class="p">](</span><span class="o">**</span><span class="n">req</span><span class="o">.</span><span class="n">view_args</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-159'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-159'>#</a>
      </div>
      <p>Dispatches the request and on top of that performs request</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">full_dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-160'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-160'>#</a>
      </div>
      <p>pre and postprocessing as well as HTTP exception catching and
error handling.</p>
<p>.. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">try_trigger_before_first_request_functions</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">request_started</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_request</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_request</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_response</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">request_finished</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-161'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-161'>#</a>
      </div>
      <p>Called before each request and will ensure that it triggers</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">try_trigger_before_first_request_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-162'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-162'>#</a>
      </div>
      <p>the :attr:<code>before_first_request_funcs</code> and only exactly once per
application instance (which means process usually).</p>
<p>:internal:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_got_first_request</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before_request_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_got_first_request</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_got_first_request</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">before_first_request_funcs</span><span class="p">:</span>
                <span class="n">func</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-163'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-163'>#</a>
      </div>
      <p>This method is called to create the default <code>OPTIONS</code> response.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">make_default_options_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-164'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-164'>#</a>
      </div>
      <p>This can be changed through subclassing to change the default
behavior of <code>OPTIONS</code> responses.</p>
<p>.. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">adapter</span> <span class="o">=</span> <span class="n">_request_ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">url_adapter</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="s">&#39;allowed_methods&#39;</span><span class="p">):</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">.</span><span class="n">allowed_methods</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-165'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-165'>#</a>
      </div>
      <p>fallback for Werkzeug &lt; 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">methods</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">adapter</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">MethodNotAllowed</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">methods</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">valid_methods</span>
            <span class="k">except</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_class</span><span class="p">()</span>
        <span class="n">rv</span><span class="o">.</span><span class="n">allow</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rv</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-166'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-166'>#</a>
      </div>
      <p>Converts the return value from a view function to a real</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">make_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rv</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-167'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-167'>#</a>
      </div>
      <p>response object that is an instance of :attr:<code>response_class</code>.</p>
<p>The following types are allowed for <code>rv</code>:</p>
<p>.. tabularcolumns:: |p{3.5cm}|p{9.5cm}|</p>
<p>======================= ===========================================
:attr:<code>response_class</code>  the object is returned unchanged
:class:<code>str</code>            a response object is created with the
                        string as body
:class:<code>unicode</code>        a response object is created with the
                        string encoded to utf-8 as body
a WSGI function         the function is called as WSGI application
                        and buffered as response object
:class:<code>tuple</code>          A tuple in the form <code>(response, status,
                        headers)</code> where <code>response</code> is any of the
                        types defined here, <code>status</code> is a string
                        or an integer and <code>headers</code> is a list of
                        a dictionary with header values.
======================= ===========================================</p>
<p>:param rv: the return value from the view function</p>
<p>.. versionchanged:: 0.9
   Previously a tuple was interpreted as the arguments for the
   response object.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">status</span> <span class="o">=</span> <span class="n">headers</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">rv</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">rv</span> <span class="o">+</span> <span class="p">(</span><span class="bp">None</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">rv</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;View function did not return a response&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_class</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-168'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-168'>#</a>
      </div>
      <p>When we create a response object directly, we let the constructor
set the headers and status.  We do this because there can be
some extra logic involved when creating these objects with
specific values (like defualt content type selection).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_class</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="n">status</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_class</span><span class="o">.</span><span class="n">force_type</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">rv</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rv</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="n">status</span>
        <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
            <span class="n">rv</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rv</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-169'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-169'>#</a>
      </div>
      <p>Creates a URL adapter for the given request.  The URL adapter</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">create_url_adapter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-170'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-170'>#</a>
      </div>
      <p>is created at a point where the request context is not yet set up
so the request is passed explicitly.</p>
<p>.. versionadded:: 0.6</p>
<p>.. versionchanged:: 0.9
   This can now also be called without a request object when the
   URL adapter is created for the application context.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">request</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">bind_to_environ</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span>
                <span class="n">server_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;SERVER_NAME&#39;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-171'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-171'>#</a>
      </div>
      <p>We need at the very least the server name to be set for this
to work.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;SERVER_NAME&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;SERVER_NAME&#39;</span><span class="p">],</span>
                <span class="n">script_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;APPLICATION_ROOT&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;/&#39;</span><span class="p">,</span>
                <span class="n">url_scheme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;PREFERRED_URL_SCHEME&#39;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-172'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-172'>#</a>
      </div>
      <p>Injects the URL defaults for the given endpoint directly into</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">inject_url_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-173'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-173'>#</a>
      </div>
      <p>the values dictionary passed.  This is used internally and
automatically called on URL building.</p>
<p>.. versionadded:: 0.7</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_default_functions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">())</span>
        <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">endpoint</span><span class="p">:</span>
            <span class="n">bp</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">funcs</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_default_functions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="p">()))</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-174'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-174'>#</a>
      </div>
      <p>Handle :class:<code>~werkzeug.routing.BuildError</code> on :meth:<code>url_for</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">handle_url_build_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-175'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-175'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_build_error_handlers</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rv</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">rv</span>
            <span class="k">except</span> <span class="n">BuildError</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-176'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-176'>#</a>
      </div>
      <p>At this point we want to reraise the exception.  If the error is
still the same one we can reraise it with the original traceback,
otherwise we raise it from here.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="n">exc_value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span>
        <span class="k">raise</span> <span class="n">error</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-177'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-177'>#</a>
      </div>
      <p>Called before the actual request dispatching and will</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">preprocess_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-178'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-178'>#</a>
      </div>
      <p>call every as :meth:<code>before_request</code> decorated function.
If any of these function returns a value it's handled as
if it was the return value from the view and further
request handling is stopped.</p>
<p>This also triggers the :meth:<code>url_value_processor</code> functions before
the actual :meth:<code>before_request</code> functions are called.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">bp</span> <span class="o">=</span> <span class="n">_request_ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">blueprint</span>

        <span class="n">funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_value_preprocessors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">())</span>
        <span class="k">if</span> <span class="n">bp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">bp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_value_preprocessors</span><span class="p">:</span>
            <span class="n">funcs</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_value_preprocessors</span><span class="p">[</span><span class="n">bp</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">view_args</span><span class="p">)</span>

        <span class="n">funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">before_request_funcs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">())</span>
        <span class="k">if</span> <span class="n">bp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">bp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">before_request_funcs</span><span class="p">:</span>
            <span class="n">funcs</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">before_request_funcs</span><span class="p">[</span><span class="n">bp</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">rv</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-179'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-179'>#</a>
      </div>
      <p>Can be overridden in order to modify the response object</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">process_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-180'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-180'>#</a>
      </div>
      <p>before it's sent to the WSGI server.  By default this will
call all the :meth:<code>after_request</code> decorated functions.</p>
<p>.. versionchanged:: 0.5
   As of Flask 0.5 the functions registered for after request
   execution are called in reverse order of registration.</p>
<p>:param response: a :attr:<code>response_class</code> object.
:return: a new response object or the same, has to be an
         instance of :attr:<code>response_class</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">ctx</span> <span class="o">=</span> <span class="n">_request_ctx_stack</span><span class="o">.</span><span class="n">top</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">blueprint</span>
        <span class="n">funcs</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">_after_request_functions</span>
        <span class="k">if</span> <span class="n">bp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">bp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">after_request_funcs</span><span class="p">:</span>
            <span class="n">funcs</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">after_request_funcs</span><span class="p">[</span><span class="n">bp</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">after_request_funcs</span><span class="p">:</span>
            <span class="n">funcs</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">after_request_funcs</span><span class="p">[</span><span class="bp">None</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_interface</span><span class="o">.</span><span class="n">is_null_session</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">session</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_session</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-181'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-181'>#</a>
      </div>
      <p>Called after the actual request dispatching and will</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">do_teardown_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-182'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-182'>#</a>
      </div>
      <p>call every as :meth:<code>teardown_request</code> decorated function.  This is
not actually called by the :class:<code>Flask</code> object itself but is always
triggered when the request context is popped.  That way we have a
tighter control over certain resources under testing environments.</p>
<p>.. versionchanged:: 0.9
   Added the <code>exc</code> argument.  Previously this was always using the
   current exception information.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">exc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">exc</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">funcs</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teardown_request_funcs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">()))</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="n">_request_ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">blueprint</span>
        <span class="k">if</span> <span class="n">bp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">bp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">teardown_request_funcs</span><span class="p">:</span>
            <span class="n">funcs</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teardown_request_funcs</span><span class="p">[</span><span class="n">bp</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
        <span class="n">request_tearing_down</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-183'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-183'>#</a>
      </div>
      <p>Called when an application context is popped.  This works pretty</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">do_teardown_appcontext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-184'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-184'>#</a>
      </div>
      <p>much the same as :meth:<code>do_teardown_request</code> but for the application
context.</p>
<p>.. versionadded:: 0.9</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">exc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">exc</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teardown_appcontext_funcs</span><span class="p">):</span>
            <span class="n">func</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
        <span class="n">appcontext_tearing_down</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-185'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-185'>#</a>
      </div>
      <p>Binds the application only.  For as long as the application is bound</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">app_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-186'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-186'>#</a>
      </div>
      <p>to the current context the :data:<code>flask.current_app</code> points to that
application.  An application context is automatically created when a
request context is pushed if necessary.</p>
<p>Example usage::</p>
<pre><code>with app.app_context():
    ...
</code></pre>
<p>.. versionadded:: 0.9</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">AppContext</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-187'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-187'>#</a>
      </div>
      <p>Creates a :class:<code>~flask.ctx.RequestContext</code> from the given</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">request_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-188'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-188'>#</a>
      </div>
      <p>environment and binds it to the current context.  This must be used in
combination with the <code>with</code> statement because the request is only bound
to the current context for the duration of the <code>with</code> block.</p>
<p>Example usage::</p>
<pre><code>with app.request_context(environ):
    do_something_with(request)
</code></pre>
<p>The object returned can also be used without the <code>with</code> statement
which is useful for working in the shell.  The example above is
doing exactly the same as this code::</p>
<pre><code>ctx = app.request_context(environ)
ctx.push()
try:
    do_something_with(request)
finally:
    ctx.pop()
</code></pre>
<p>.. versionchanged:: 0.3
   Added support for non-with statement usage and <code>with</code> statement
   is now passed the ctx object.</p>
<p>:param environ: a WSGI environment</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">RequestContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-189'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-189'>#</a>
      </div>
      <p>Creates a WSGI environment from the given values (see</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_request_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-190'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-190'>#</a>
      </div>
      <p>:func:<code>werkzeug.test.EnvironBuilder</code> for more information, this
function accepts the same arguments).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="kn">from</span> <span class="nn">flask.testing</span> <span class="kn">import</span> <span class="n">make_test_environ_builder</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">make_test_environ_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_context</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">get_environ</span><span class="p">())</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-191'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-191'>#</a>
      </div>
      <p>The actual WSGI application.  This is not implemented in</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">wsgi_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-192'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-192'>#</a>
      </div>
      <p><code>__call__</code> so that middlewares can be applied without losing a
reference to the class.  So instead of doing this::</p>
<pre><code>app = MyMiddleware(app)
</code></pre>
<p>It's a better idea to do this instead::</p>
<pre><code>app.wsgi_app = MyMiddleware(app.wsgi_app)
</code></pre>
<p>Then you still have the original application object around and
can continue to call methods on it.</p>
<p>.. versionchanged:: 0.7
   The behavior of the before and after request callbacks was changed
   under error conditions and a new callback was added that will
   always execute at the end of the request, independent on if an
   error occurred or not.  See :ref:<code>callbacks-and-errors</code>.</p>
<p>:param environ: a WSGI environment
:param start_response: a callable accepting a status code,
                       a list of headers and an optional
                       exception context to start the response</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_context</span><span class="p">(</span><span class="n">environ</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dispatch_request</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_exception</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">response</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-193'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-193'>#</a>
      </div>
      <p>Shortcut for :attr:<code>wsgi_app</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">modules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
        <span class="n">warn</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s">&#39;Flask.modules is deprecated, use &#39;</span>
                                <span class="s">&#39;Flask.blueprints instead&#39;</span><span class="p">),</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">blueprints</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-194'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-194'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  
</div>
</body>
